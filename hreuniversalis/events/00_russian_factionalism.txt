namespace = russian_factionalism

########################################
# Factionalism of the Rus
########################################

#Start
country_event = {
    id = russian_factionalism.1
    title = russian_factionalism.1.t
    desc = russian_factionalism.1.d
	picture = {
		trigger = { NOT = { has_dlc = "Third Rome" } }
		picture = COUNTRY_COLLAPSE_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Third Rome" }
		picture = PRINCE_AND_BOYARS_eventPicture
	}

	is_triggered_only = yes
	major = yes

    mean_time_to_happen = {
        days = 1
	}
	
	immediate = {
		hidden_effect = {
			set_country_flag = had_russian_factionalism
			if = {
				limit = {
					has_dlc = "Third Rome"
					has_government_mechanic = russian_mechanic
				}
				add_government_power = {
					government_mechanic = russian_mechanic
					which = ADM
					amount = -150
				}
				add_government_power = {
					government_mechanic = russian_mechanic
					which = DIP
					amount = -150
				}
				add_government_power = {
					government_mechanic = russian_mechanic
					which = MIL
					amount = -150
				}
			}
			random_owned_province = {
				limit = {
					can_spawn_rebels = nationalist_rebels
				}
				spawn_rebels = {
					type = nationalist_rebels
					size = 2
				}
			}
			random_owned_province = {
				limit = {
					can_spawn_rebels = nationalist_rebels
				}
				spawn_rebels = {
					type = nationalist_rebels 
					size = 2
				}
			}
			random_owned_province = {
				limit = {
					can_spawn_rebels = nationalist_rebels
				}
				spawn_rebels = {
					type = nationalist_rebels 
					size = 2
				}
			}
			random_owned_province = {
				limit = {
					can_spawn_rebels = nationalist_rebels
				}
				spawn_rebels = {
					type = nationalist_rebels 
					size = 2
				}
			}
			random_owned_province = {
				limit = {
					can_spawn_rebels = nationalist_rebels
				}
				spawn_rebels = {
					type = nationalist_rebels 
					size = 2
				}
			}
			every_subject_country = {
				limit = { historical_friend_with = ROOT }
				remove_historical_friend = ROOT
				ROOT = {
					remove_historical_friend = PREV
				}
			}
			if = {
				limit = { has_country_modifier = yaroslavichi_triumvirate }
				remove_country_modifier = yaroslavichi_triumvirate
			}
		}
	}

    option = {
		name = russian_factionalism.1.a
		add_stability = -3
		add_mandate = -35
		add_meritocracy = -35
    }
}

#Rebels
country_event = {
	id = russian_factionalism.2
	title = "russian_factionalism.2.t"
	desc = "russian_factionalism.2.d"
	picture = ANGRY_MOB_eventPicture
	goto = kiev_reb_prov
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_province = {
			is_state = yes
			NOT = { local_autonomy = 75 }
		}
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_state = yes
					NOT = { local_autonomy = 75 }
				}
				save_event_target_as = kiev_reb_prov
			}
		}
	}
	
	option = {
		name = russian_factionalism.2.a
		ai_chance = { factor = 1 }
		add_mandate = 5
		event_target:kiev_reb_prov = {
			if = {
				limit = { can_spawn_rebels = nationalist_rebels }
				spawn_rebels = {
					type = nationalist_rebels 
					size = 2
				}			
			}
			else = {
				spawn_rebels = {
					type = anti_tax_rebels
					size = 2
				}
			}
		}
	}
	option = {
		name = russian_factionalism.2.b
		ai_chance = { factor = 0 }
		add_mandate = -5
		event_target:kiev_reb_prov = {
			area = {
				limit = {
					owned_by = ROOT
				}
				add_local_autonomy = 50
			}
		}
	}
}

#Abandon Tmutarakan?
country_event = {
	id = russian_factionalism.3
	title = "russian_factionalism.3.t"
	desc = "russian_factionalism.3.d"
	picture = MERCHANTS_TALKING_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		TMT = {
			exists = yes
			ai = yes
			is_subject_of = ROOT
			is_subject_of_type = tributary_state
		}
	}

	option = {
		name = russian_factionalism.3.a
		add_mandate = -10
		TMT = {
			grant_independence = yes
		}
		add_truce_with = TMT
		reverse_add_opinion = {
			who = TMT
			modifier = opinion_bad_monarch
		}
	}
	option = {
		name = russian_factionalism.3.b
		add_mandate = 10
		TMT = {
			add_liberty_desire = 50
		}
	}
}

#Abandon Volyn?
country_event = {
	id = russian_factionalism.4
	title = "russian_factionalism.4.t"
	desc = "russian_factionalism.4.d"
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		VHN = {
			exists = yes
			ai = yes
			is_subject_of = ROOT
			is_subject_of_type = tributary_state
		}
	}

	immediate = {
		hidden_effect = {
			VHN = { grant_independence = yes }
			every_subject_country = {
				limit = {
					NOT = { tag = VHN }
					is_subject_of_type = tributary_state
					primary_culture = volhynian
				}
				grant_independence = yes
				VHN = {
					vassalize = PREV
				}
				ROOT = { add_truce_with = PREV }
			}
		}
	}

	option = {
		name = russian_factionalism.4.a
		add_mandate = -10
		if = {
			limit = { exists = PLC }
			PLC = { create_guarantee = VHN }
		}
		else_if = {
			limit = { exists = POL }
			POL = { create_guarantee = VHN }
		}
		else_if = {
			limit = { exists = KRA }
			KRA = { create_guarantee = VHN }
		}
		add_truce_with = VHN
	}
	option = {
		name = russian_factionalism.4.b
		add_mandate = 10
		VHN = { set_country_flag = allow_quick_tributary_cb }
		declare_war_with_cb = {
			casus_belli = cb_force_tributary
			who = VHN
		}
		VHN = { clr_country_flag = allow_quick_tributary_cb }
	}
}

#Abandon Vladimir?
country_event = {
	id = russian_factionalism.5
	title = "russian_factionalism.5.t"
	desc = "russian_factionalism.5.d"
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		VDR = {
			exists = yes
			ai = yes
			is_subject_of = ROOT
			is_subject_of_type = tributary_state
		}
	}

	immediate = {
		hidden_effect = {
			VDR = {
				set_country_flag = broke_from_kievan_rus
				add_stability = 3
				add_war_exhaustion = -10
				grant_independence = yes
				every_enemy_country = {
					white_peace = VDR
				}
				define_ruler = {
					dynasty = "Rurikovich"
					adm = 4
					dip = 4
					mil = 4
				}
				add_yearly_manpower = 10
				add_years_of_income = 10
			}
			every_subject_country = {
				limit = {
					NOT = { tag = VDR }
					is_subject_of_type = tributary_state
					primary_culture = russian
				}
				grant_independence = yes
				VDR = {
					vassalize = PREV
				}
				ROOT = { add_truce_with = PREV }
			}
		}
	}

	option = {
		name = russian_factionalism.5.a
		add_mandate = -10
		add_stability = -1
	}
	option = {
		name = russian_factionalism.5.b
		add_mandate = 10
		VDR = {
			declare_war_with_cb = {
				casus_belli = cb_take_mandate
				who = ROOT
			}
		}
	}
}

#Abandon Chernigov & Pereyslav?
country_event = {
	id = russian_factionalism.6
	title = "russian_factionalism.6.t"
	desc = "russian_factionalism.6.d"
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		OR = {
			CHR = {
				exists = yes
				ai = yes
				is_subject_of = ROOT
				is_subject_of_type = tributary_state
			}
			PLL = {
				exists = yes
				ai = yes
				is_subject_of = ROOT
				is_subject_of_type = tributary_state
			}
		}
	}

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					CHR = {
						exists = yes
						ai = yes
						is_subject_of = ROOT
						is_subject_of_type = tributary_state
					}
				}
				every_subject_country = {
					limit = {
						NOT = { tag = CHR }
						NOT = { tag = PLL }
						is_subject_of_type = tributary_state
						primary_culture = severian
					}
					grant_independence = yes
					CHR = {
						vassalize = PREV
					}
					ROOT = { add_truce_with = PREV }
				}
			}
			else_if = {
				limit = {
					PLL = {
						exists = yes
						ai = yes
						is_subject_of = ROOT
						is_subject_of_type = tributary_state
					}
				}
				every_subject_country = {
					limit = {
						NOT = { tag = CHR }
						NOT = { tag = PLL }
						is_subject_of_type = tributary_state
						primary_culture = severian
					}
					grant_independence = yes
					PLL = {
						vassalize = PREV
					}
					ROOT = { add_truce_with = PREV }
				}
			}
		}
	}

	option = {
		name = russian_factionalism.6.a
		add_mandate = -5
		add_meritocracy = -10
		if = {
			limit = {
				CHR = {
					exists = yes
					ai = yes
					is_subject_of = ROOT
					is_subject_of_type = tributary_state
				}
			}
			CHR = { grant_independence = yes }
			add_truce_with = CHR
		}
		if = {
			limit = {
				PLL = {
					exists = yes
					ai = yes
					is_subject_of = ROOT
					is_subject_of_type = tributary_state
				}
			}
			PLL = { grant_independence = yes }
			add_truce_with = PLL
		}
	}
	option = {
		name = russian_factionalism.6.b
		add_mandate = 15
		if = {
			limit = {
				CHR = {
					exists = yes
					ai = yes
					is_subject_of = ROOT
					is_subject_of_type = tributary_state
				}
			}
			CHR = { grant_independence = yes }
			CHR = { set_country_flag = allow_quick_tributary_cb }
			declare_war_with_cb = {
				casus_belli = cb_force_tributary
				who = CHR
			}
			CHR = { clr_country_flag = allow_quick_tributary_cb }
		}
		if = {
			limit = {
				PLL = {
					exists = yes
					ai = yes
					is_subject_of = ROOT
					is_subject_of_type = tributary_state
				}
			}
			PLL = { grant_independence = yes }
			PLL = { set_country_flag = allow_quick_tributary_cb }
			declare_war_with_cb = {
				casus_belli = cb_force_tributary
				who = PLL
			}
			PLL = { clr_country_flag = allow_quick_tributary_cb }
		}
	}
}

#Abandon Novgorod?
country_event = {
	id = russian_factionalism.7
	title = "russian_factionalism.7.t"
	desc = "russian_factionalism.7.d"
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		NOV = {
			exists = yes
			ai = yes
			is_subject_of = ROOT
			is_subject_of_type = tributary_state
		}
	}

	immediate = {
		hidden_effect = {
			NOV = { grant_independence = yes }
		}
	}
	
	option = {
		name = russian_factionalism.7.a
		add_mandate = -10
		add_truce_with = NOV
	}
	option = {
		name = russian_factionalism.7.b
		add_mandate = 10
		declare_war_with_cb = {
			casus_belli = cb_force_tributary
			who = NOV
		}
	}
}

#Random Appanage gets liberty desire
country_event = {
	id = russian_factionalism.8
	title = "russian_factionalism.8.t"
	desc = "russian_factionalism.8.d"
	picture = DIPLOMACY_eventPicture
	goto = rand_appa_cap
	
	is_triggered_only = yes

	trigger = {
		normal_or_historical_nations = yes
		is_emperor_of_china = yes
		any_subject_country = {
			is_subject_of_type = tributary_state
			ai = yes
			NOT = {
				tag = TMT
				tag = VHN
				tag = VDR
				tag = CHR
				tag = PLL
				tag = NOV
			}
			NOT = { has_country_flag = had_increased_liberty_desire }
		}
	}

	immediate = {
		hidden_effect = {
			random_subject_country = {
				limit = {
					is_subject_of_type = tributary_state
					ai = yes
					NOT = {
						tag = TMT
						tag = VHN
						tag = VDR
						tag = CHR
						tag = PLL
						tag = NOV
					}
					NOT = { has_country_flag = had_increased_liberty_desire }
				}
				save_event_target_as = rand_appa
				set_country_flag = had_increased_liberty_desire
				capital_scope = {
					save_event_target_as = rand_appa_cap
				}
			}
		}
	}
	
	option = {
		name = russian_factionalism.8.a
		add_mandate = -5
		event_target:rand_appa = {
			add_liberty_desire = 25
		}
	}
	option = {
		name = russian_factionalism.8.b
		add_mandate = 5
		add_corruption = 1
	}
}


#End
country_event = {
    id = russian_factionalism.100
    title = russian_factionalism.100.t
	desc = russian_factionalism.100.d
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	major = yes

	immediate = {
		hidden_effect = {
			every_country = {
				limit = { has_country_flag = had_increased_liberty_desire }
				clr_country_flag = had_increased_liberty_desire			
			}
		}
	}

	option = {
		name = russian_factionalism.100.a
		if = {
			limit = { is_emperor_of_china = yes }
			add_mandate = 20
			add_meritocracy = 20
		}
		else = {
			add_stability_or_adm_power = yes
			add_legitimacy = 10
		}
	}
}

# country_event = {
# 	id = russian_factionalism.9
#     title = russian_factionalism.9.t
# 	desc = russian_factionalism.9.d
# 	picture = CIVIL_WAR_eventPicture

# 	is_triggered_only = yes

# 	option = {
# 		name = russian_factionalism.9.a
# 		BOO
# 		BTY
# 		BTV
# 		CHR
# 		DGO
# 		DTV
# 		KIE
# 		KMO
# 		KRH
# 		KSK
# 		LKS
# 		MEY
# 		MOA
# 		MOS
# 		MRM
# 		MSK
# 		OBL
# 		OKA
# 		ONU
# 		ORY
# 		PLL
# 		PLT
# 		PNK
# 		PSL
# 		PZK
# 		PZS
# 		RSO
# 		RYA
# 		SDB
# 		SKS
# 		SMO
# 		SPZ
# 		SVK
# 		TAA
# 		TBS
# 		TMT
# 		TPT
# 		TUV
# 		TVE
# 		UGL
# 		VBK
# 		VDR
# 		VHN
# 		VOL
# 		VOO
# 		VTY
# 		XKA
# 		XMO
# 		XPY
# 		XSZ
# 		YAR
# 		YYV
# 		ZNY

# 		NOV
# 		PSK
# 		VYT
# 	}
# }